<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Bazar - Craft Your Career</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Lora:wght@600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <style>
        :root {
            --primary-color: #556B2F; /* Olive Drab */
            --secondary-color: #8B4513; /* Saddle Brown */
            --accent-color: #E3856B; /* Tangerine */
            --background-color: #F5F5DC; /* Parchment */
            --card-background: #FFFFFF;
            --text-color: #2F2F2F;
            --subtle-text: #6B7280;
            --border-color: #E5E7EB;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.04);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.07), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* --- General & Animations --- */
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .fade-in {
            opacity: 0;
            transition: opacity 0.5s ease-out;
        }
        .fade-in.visible {
            opacity: 1;
        }
        .hidden { display: none !important; }

        /* --- Header --- */
        .header {
            background: var(--card-background);
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none !important;
            color: var(--primary-color);
        }
        .logo:hover { text-decoration: none !important; }
        .logo-text {
            font-family: 'Lora', serif;
            font-weight: 700;
            font-size: 1.75rem;
        }
        .header-nav {
            display: none;
            align-items: center;
            gap: 0.5rem;
        }
        @media (min-width: 1024px) {
            .header-nav { display: flex; }
        }
        .header-nav .nav-link {
            font-weight: 600;
            color: var(--subtle-text);
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 8px;
            transition: background-color 0.2s, color 0.2s;
            white-space: nowrap;
        }
        .header-nav .nav-link.active, .header-nav .nav-link:hover {
            color: var(--primary-color);
            background-color: #F0F2E6;
        }
        .auth-buttons button, .user-info button {
            background: transparent;
            border: 1px solid var(--border-color);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin-left: 0.5rem;
            transition: background-color 0.2s ease;
        }
        .auth-buttons button.primary {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        .user-info { display: flex; align-items: center; gap: 1rem; }
        .header-right { display: flex; align-items: center; gap: 1rem; }

        /* --- Hero Section --- */
        .hero {
            text-align: center;
            padding: 5rem 1.5rem;
            position: relative;
            overflow: hidden;
        }
        .hero-bg {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: #F0F2E6;
            background-image: url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23556B2F" fill-opacity="0.04"%3E%3Cpath d="M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');
            z-index: -1;
        }
        .hero h1 {
            font-family: 'Lora', serif;
            margin: 0 0 1rem 0;
            font-size: clamp(2rem, 5vw, 2.5rem);
        }
        .hero p {
            font-size: clamp(1rem, 2.5vw, 1.125rem);
            color: var(--subtle-text);
            max-width: 600px;
            margin: 0 auto 2.5rem auto;
        }
        .search-wrapper {
            background: var(--card-background);
            border-radius: 50px;
            padding: 0.5rem;
            display: flex;
            max-width: 700px;
            margin: 0 auto;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-lg);
        }
        #search-bar {
            flex-grow: 1;
            padding: 12px 24px;
            font-size: 16px;
            border: none;
            background: transparent;
            outline: none;
        }
        .search-button {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
        }

        /* --- Main Content Layout --- */
        .main-content { padding: 2rem 1.5rem; }
        .main-layout {
            display: grid;
            grid-template-columns: 40% 1fr;
            gap: 2rem;
            max-width: 1280px;
            margin: 0 auto;
        }
        .results-column, .detail-pane {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        .results-column.visible, .detail-pane.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .results-column {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        #job-listings {
            display: grid;
            gap: 1.5rem;
            overflow-y: auto;
            max-height: 75vh;
            padding-right: 8px;
        }
        .job-card {
            background-color: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow);
            transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
            cursor: pointer;
            position: relative;
        }
        .job-card.selected, .job-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--accent-color);
        }
        .card-top {
            display: flex;
            gap: 16px;
            align-items: center;
            margin-bottom: 16px;
        }
        .company-logo {
            width: 50px; height: 50px; border-radius: 12px;
            background-color: #F3F4F6;
            border: 1px solid var(--border-color);
            display: flex; align-items: center; justify-content: center;
            font-weight: 600; font-size: 1.5rem;
            color: var(--primary-color);
            flex-shrink: 0;
        }
        .card-info h2 { font-family: 'Lora', serif; margin: 0; font-size: 22px; font-weight: 600; }
        .card-info .company { font-weight: 500; color: var(--subtle-text); margin-top: 4px; font-size: 16px; }
        .card-details { display: flex; flex-wrap: wrap; gap: 12px; font-size: 14px; }
        .detail-tag {
            display: flex; align-items: center; gap: 6px;
            background-color: #F9FAFB; padding: 6px 12px;
            border-radius: 50px; color: var(--subtle-text);
            border: 1px solid var(--border-color);
        }

        /* --- Detail Pane --- */
        .detail-pane {
            background: var(--card-background);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            position: sticky; top: 100px;
            max-height: 85vh;
            overflow-y: auto;
            display: flex; flex-direction: column;
        }
        .detail-header { padding: 24px; border-bottom: 1px solid var(--border-color); }
        .detail-header h2 { font-family: 'Lora', serif; margin: 0; font-size: 24px; }
        .detail-body { padding: 24px; line-height: 1.6; }
        .detail-body h3 { font-family: 'Lora', serif; }

        /* --- AI Resume Rater --- */
        #resume-rater-portal { text-align: center; max-width: 800px; margin: 2rem auto; }
        #resume-upload-label {
            display: inline-block;
            padding: 1rem 2rem;
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 1rem;
            transition: background-color 0.2s;
        }
        #resume-upload-label:hover { background-color: #4A5C28; }
        #resume-file-input { display: none; }
        #file-name { color: var(--subtle-text); font-style: italic; }

        #resume-results {
            background: var(--card-background);
            border-radius: 12px; padding: 2rem;
            margin-top: 2rem; text-align: left;
            opacity: 0; transition: opacity 0.5s;
        }
        #resume-results.visible { opacity: 1; }
        #resume-results h3 { font-family: 'Lora', serif; }
        
        /* --- Language Selector --- */
        #language-selector {
            border: 1px solid var(--border-color);
            padding: 0.5rem; border-radius: 8px;
            font-weight: 600;
        }

        /* --- Modals --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            display: none; align-items: center; justify-content: center;
            z-index: 2000; opacity: 0;
            transition: opacity 0.3s ease;
        }
        .modal-overlay.visible { display: flex; opacity: 1; }
        .modal-content {
            background: var(--card-background);
            border-radius: 16px;
            width: 90%; max-width: 450px;
            box-shadow: var(--shadow-lg);
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        .modal-overlay.visible .modal-content { transform: scale(1); }
        .modal-header { padding: 24px; border-bottom: 1px solid var(--border-color); }
        .modal-header h2 { font-family: 'Lora', serif; margin: 0; }
        .modal-body { padding: 24px; line-height: 1.6; }
        .modal-footer { padding: 16px 24px; border-top: 1px solid var(--border-color); text-align: right; }
        .close-button {
            background: #F3F4F6; border: 1px solid var(--border-color);
            padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600;
        }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; font-weight: 500; margin-bottom: 0.5rem; }
        .form-group input, .form-group textarea {
            width: 100%; padding: 12px;
            font-size: 16px; border: 1px solid var(--border-color);
            border-radius: 8px; box-sizing: border-box;
        }
        
        /* --- Responsive Design --- */
        @media (max-width: 900px) {
            .header-nav {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: var(--card-background);
                border-top: 1px solid var(--border-color);
                justify-content: space-around;
                padding: 0.5rem 0;
                display: flex; /* Ensure it's visible on mobile */
            }
            .header-nav .nav-link {
                flex-direction: column;
                font-size: 0.75rem;
                gap: 2px;
            }
            body { padding-bottom: 70px; } /* Space for bottom nav */
            .main-layout { grid-template-columns: 1fr; }
            .detail-pane { display: none; }
            #job-listings { max-height: none; padding-right: 0; }
        }
    </style>
</head>
<body>

    <header class="header">
        <a href="#" class="logo">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" stroke="var(--primary-color)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M12 2L13.55 5.13L15.5 6.27L13.55 7.41L12 10.54L10.45 7.41L8.5 6.27L10.45 5.13L12 2Z" fill="var(--primary-color)" opacity="0.5"/>
            </svg>
            <span class="logo-text" data-lang-key="logoText">Job Bazar</span>
        </a>
        <nav class="header-nav" id="main-nav">
            <!-- Nav links will be populated by JS -->
        </nav>
        <div class="header-right">
            <select id="language-selector">
                <option value="en">English</option>
                <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
                <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
            </select>
            <div class="auth-buttons" id="auth-container">
                <!-- Auth state will be rendered here -->
            </div>
        </div>
    </header>

    <main id="app-root">
        <!-- SPA content will be rendered here by JavaScript -->
    </main>

    <!-- All Modals are defined once at the top level -->
    <div id="modal-container">
        <!-- Auth Modal -->
        <div class="modal-overlay" id="auth-modal">
            <div class="modal-content">
                <div class="modal-header"><h2 id="auth-modal-title">Sign In</h2></div>
                <div class="modal-body">
                    <form id="email-form">
                        <div class="form-group"><label for="email">Email</label><input type="email" id="email" required></div>
                        <div class="form-group"><label for="password">Password</label><input type="password" id="password" required></div>
                        <button type="submit" class="search-button" style="width: 100%;" id="email-form-button">Sign In</button>
                    </form>
                </div>
                <div class="modal-footer"><button class="close-button">Close</button></div>
            </div>
        </div>
        <!-- Dashboard Modal -->
        <div class="modal-overlay" id="dashboard-modal">
            <div class="modal-content" style="max-width: 500px;">
                <div class="modal-header"><h2>My Dashboard</h2></div>
                <div class="modal-body">
                     <h3>My Career Goals</h3>
                    <p>Help our AI find the best jobs for you. What is your primary career goal right now?</p>
                    <form id="career-goals-form">
                        <div class="form-group">
                            <label for="career-goal">Describe your ideal next role or career path:</label>
                            <textarea id="career-goal" placeholder="e.g., 'I'm a junior developer looking to move into a mid-level role focused on backend systems with Python and AWS.'"></textarea>
                        </div>
                        <button type="submit" class="search-button" style="width: 100%;">Save Goals</button>
                    </form>
                </div>
                <div class="modal-footer"><button class="close-button">Close</button></div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK Scripts -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
    // --- START OF TRANSLATIONS ---
    const translations = {
        en: {
            logoText: "Job Bazar",
            navJobs: "Find a Job",
            navFreelance: "Freelance Work",
            navServices: "Tradespeople",
            navResumeRater: "AI Resume Rater",
            heroTitle: "Craft Your Career",
            heroSubtitle: "A thoughtfully curated space for professionals seeking meaningful work.",
            searchPlaceholder: "Job Title, Skill, or Company",
            findJobsBtn: "Find Jobs",
            signIn: "Sign In",
            signUp: "Sign Up",
            signOut: "Sign Out",
            myDashboard: "My Dashboard"
        },
        hi: {
            logoText: "‡§ú‡•â‡§¨ ‡§¨‡§æ‡§ú‡§º‡§æ‡§∞",
            navJobs: "‡§®‡•å‡§ï‡§∞‡•Ä ‡§¢‡•Ç‡§Ç‡§¢‡•á‡§Ç",
            navFreelance: "‡§´‡•ç‡§∞‡•Ä‡§≤‡§æ‡§Ç‡§∏ ‡§ï‡§æ‡§∞‡•ç‡§Ø",
            navServices: "‡§ü‡•ç‡§∞‡•á‡§°‡•ç‡§∏ ‡§™‡•Ä‡§™‡§≤",
            navResumeRater: "AI ‡§∞‡§ø‡§ú‡•ç‡§Ø‡•Ç‡§Æ‡•á ‡§∞‡•á‡§ü‡§∞",
            heroTitle: "‡§Ö‡§™‡§®‡§æ ‡§ï‡§∞‡§ø‡§Ø‡§∞ ‡§¨‡§®‡§æ‡§è‡§Ç",
            heroSubtitle: "‡§∏‡§æ‡§∞‡•ç‡§•‡§ï ‡§ï‡§æ‡§Æ ‡§ï‡•Ä ‡§§‡§≤‡§æ‡§∂ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§™‡•á‡§∂‡•á‡§µ‡§∞‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§µ‡§ø‡§ö‡§æ‡§∞‡§∂‡•Ä‡§≤ ‡§∏‡•ç‡§•‡§æ‡§®‡•§",
            searchPlaceholder: "‡§®‡•å‡§ï‡§∞‡•Ä ‡§ï‡§æ ‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï, ‡§ï‡•å‡§∂‡§≤, ‡§Ø‡§æ ‡§ï‡§Ç‡§™‡§®‡•Ä",
            findJobsBtn: "‡§®‡•å‡§ï‡§∞‡§ø‡§Ø‡§æ‡§Ç ‡§¢‡•Ç‡§Ç‡§¢‡•á‡§Ç",
            signIn: "‡§∏‡§æ‡§á‡§® ‡§á‡§® ‡§ï‡§∞‡•á‡§Ç",
            signUp: "‡§∏‡§æ‡§á‡§® ‡§Ö‡§™ ‡§ï‡§∞‡•á‡§Ç",
            signOut: "‡§∏‡§æ‡§á‡§® ‡§Ü‡§â‡§ü ‡§ï‡§∞‡•á‡§Ç",
            myDashboard: "‡§Æ‡•á‡§∞‡§æ ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°"
        },
        bn: {
            logoText: "‡¶ú‡¶¨ ‡¶¨‡¶æ‡¶ú‡¶æ‡¶∞",
            navJobs: "‡¶ö‡¶æ‡¶ï‡¶∞‡¶ø ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®",
            navFreelance: "‡¶´‡ßç‡¶∞‡¶ø‡¶≤‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶∏ ‡¶ï‡¶æ‡¶ú",
            navServices: "‡¶ü‡ßç‡¶∞‡ßá‡¶°ÿ≥Ÿæ‡¶ø‡¶™‡¶≤",
            navResumeRater: "AI ‡¶ú‡ßÄ‡¶¨‡¶®‡¶¨‡ßÉ‡¶§‡ßç‡¶§‡¶æ‡¶®‡ßç‡¶§ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶ï",
            heroTitle: "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®",
            heroSubtitle: "‡¶∏‡¶æ‡¶∞‡ßç‡¶•‡¶ï ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶∏‡¶®‡ßç‡¶ß‡¶æ‡¶®‡ßá ‡¶•‡¶æ‡¶ï‡¶æ ‡¶™‡ßá‡¶∂‡¶æ‡¶¶‡¶æ‡¶∞‡¶¶‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ö‡¶ø‡¶®‡ßç‡¶§‡¶æ‡¶∂‡ßÄ‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶ú‡ßç‡¶ú‡¶ø‡¶§ ‡¶∏‡ßç‡¶•‡¶æ‡¶®‡•§",
            searchPlaceholder: "‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ, ‡¶¶‡¶ï‡ßç‡¶∑‡¶§‡¶æ, ‡¶¨‡¶æ ‡¶∏‡¶Ç‡¶∏‡ßç‡¶•‡¶æ",
            findJobsBtn: "‡¶ö‡¶æ‡¶ï‡¶∞‡¶ø ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®",
            signIn: "‡¶∏‡¶æ‡¶á‡¶® ‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®",
            signUp: "‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®",
            signOut: "‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®",
            myDashboard: "‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°"
        }
    };
    // --- END OF TRANSLATIONS ---

    // --- START OF FIREBASE SETUP ---
    const firebaseConfig = {
      apiKey: "AIzaSyDjn8WgssBtikX6QKxHXnDsheeSz8cvw3k",
      authDomain: "job-bazar-app.firebaseapp.com",
      projectId: "job-bazar-app",
      storageBucket: "job-bazar-app.firebasestorage.app",
      messagingSenderId: "1092941552619",
      appId: "1:1092941552619:web:1c93949ed0acdada6a17ae"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    const googleProvider = new firebase.auth.GoogleAuthProvider();
    // --- END OF FIREBASE SETUP ---

    // --- START OF GEMINI API SETUP ---
    const GEMINI_API_KEY = ""; // PASTE YOUR GEMINI API KEY HERE
    // --- END OF GEMINI API SETUP ---

    // Global State
    let state = {
        allJobs: [],
        allFreelance: [],
        allServices: [],
        currentUser: null,
        userData: { savedJobs: [], careerGoal: '' },
        currentView: 'jobs',
        currentLang: 'en'
    };
    
    // DOM References
    const appRoot = document.getElementById('app-root');
    const mainNav = document.getElementById('main-nav');
    const authContainer = document.getElementById('auth-container');
    const modalContainer = document.getElementById('modal-container');
    const languageSelector = document.getElementById('language-selector');

    // --- LANGUAGE & TRANSLATION ---
    function setLanguage(lang) {
        state.currentLang = lang;
        document.documentElement.lang = lang;
        updateUIText();
    }

    function updateUIText() {
        const langData = translations[state.currentLang];
        document.querySelectorAll('[data-lang-key]').forEach(el => {
            const key = el.dataset.langKey;
            if (langData[key]) {
                el.textContent = langData[key];
            }
        });
        document.querySelectorAll('[data-lang-key-placeholder]').forEach(el => {
            const key = el.dataset.langKeyPlaceholder;
            if(langData[key]) {
                el.placeholder = langData[key];
            }
        });
        renderAuthUI();
    }
    
    // --- ROUTING / VIEW MANAGEMENT ---
    function navigate(view) {
        state.currentView = view;
        renderApp();
    }

    function renderApp() {
        updateNavLinks();
        appRoot.innerHTML = ''; // Clear previous view
        appRoot.classList.add('fade-in');

        switch(state.currentView) {
            case 'jobs':
                appRoot.innerHTML = getPortalHTML('jobs');
                initializePortal('jobs', state.allJobs, renderJobCard, renderJobDetails);
                break;
            case 'freelance':
                appRoot.innerHTML = getPortalHTML('freelance');
                initializePortal('freelance', state.allFreelance, renderFreelanceCard, renderFreelanceDetails);
                break;
            case 'services':
                 appRoot.innerHTML = getPortalHTML('services');
                initializePortal('services', state.allServices, renderServiceCard, renderServiceDetails);
                break;
            case 'resumeRater':
                appRoot.innerHTML = getResumeRaterHTML();
                document.getElementById('resume-upload-label').addEventListener('click', () => document.getElementById('resume-file-input').click());
                document.getElementById('resume-file-input').addEventListener('change', handleFileSelect);
                document.getElementById('analyze-resume-btn').addEventListener('click', analyzeResume);
                break;
        }
        
        setTimeout(() => appRoot.classList.add('visible'), 50);
        updateUIText();
    }
    
    function updateNavLinks() {
        mainNav.innerHTML = `
            <a href="#" class="nav-link ${state.currentView === 'jobs' ? 'active' : ''}" data-view="jobs" data-lang-key="navJobs">Find a Job</a>
            <a href="#" class="nav-link ${state.currentView === 'freelance' ? 'active' : ''}" data-view="freelance" data-lang-key="navFreelance">Freelance Work</a>
            <a href="#" class="nav-link ${state.currentView === 'services' ? 'active' : ''}" data-view="services" data-lang-key="navServices">Tradespeople</a>
            <a href="#" class="nav-link ${state.currentView === 'resumeRater' ? 'active' : ''}" data-view="resumeRater" data-lang-key="navResumeRater">AI Resume Rater</a>
        `;
    }

    // --- HTML TEMPLATES ---
    function getPortalHTML(portalType) {
        return `
            <section class="hero">
                <div class="hero-bg"></div>
                <h1 data-lang-key="heroTitle">Craft Your Career</h1>
                <p data-lang-key="heroSubtitle">A thoughtfully curated space for professionals seeking meaningful work.</p>
                <div class="search-wrapper">
                    <input type="text" id="search-bar" data-lang-key-placeholder="searchPlaceholder" placeholder="Job Title, Skill, or Company">
                    <button class="search-button" data-lang-key="findJobsBtn">Find Jobs</button>
                </div>
            </section>
            <div class="main-content">
                <div class="main-layout">
                    <div class="results-column">
                        <div id="job-listings"></div>
                    </div>
                    <div class="detail-pane">
                         <div class="detail-placeholder">
                            <h3>Select an item to view details</h3>
                        </div>
                    </div>
                </div>
            </div>`;
    }

    function getResumeRaterHTML() {
        return `
            <section class="hero">
                <div class="hero-bg"></div>
                <h1>AI Resume Rater</h1>
                <p>Get instant feedback from our AI career coach to improve your resume.</p>
            </section>
            <div id="resume-rater-portal" class="main-content">
                 <input type="file" id="resume-file-input" accept=".txt,.md,.pdf">
                 <label for="resume-file-input" id="resume-upload-label">Upload Resume</label>
                 <p id="file-name"></p>
                <button id="analyze-resume-btn" class="search-button">Analyze My Resume</button>
                <div id="resume-results" class="hidden">
                    <!-- AI analysis will appear here -->
                </div>
            </div>`;
    }
    
    // --- INITIALIZATION ---
    function initializePortal(portalType, data, cardRenderer, detailRenderer) {
        const listingsContainer = document.getElementById('job-listings');
        const detailPane = document.querySelector('.detail-pane');
        
        function displayItems(items) {
            listingsContainer.innerHTML = '';
            if (items.length === 0) {
                listingsContainer.innerHTML = '<p>No listings found.</p>';
                return;
            }
            items.forEach(item => {
                const card = cardRenderer(item);
                card.addEventListener('click', () => {
                     if (window.innerWidth <= 900) {
                        // Mobile modal logic would go here
                    } else {
                        document.querySelectorAll('.job-card.selected').forEach(c => c.classList.remove('selected'));
                        card.classList.add('selected');
                        detailPane.innerHTML = detailRenderer(item);
                    }
                });
                listingsContainer.appendChild(card);
            });
        }
        displayItems(data);
    }
    
    // Card Renderers
    function renderJobCard(job) {
        const card = document.createElement('div');
        card.className = 'job-card';
        card.innerHTML = `
            <div class="card-top">
                <div class="company-logo">${job.Company.charAt(0)}</div>
                <div class="card-info">
                    <h2>${job['Job Title']}</h2>
                    <p class="company">${job.Company}</p>
                </div>
            </div>
            <div class="card-details">
                <span class="detail-tag">üìç ${job.Location}</span>
                <span class="detail-tag">üí∞ ${job.Salary}</span>
            </div>`;
        return card;
    }

    function renderFreelanceCard(gig) {
        const card = document.createElement('div');
        card.className = 'job-card';
        card.innerHTML = `
            <div class="card-top">
                <div class="company-logo">${gig.Client.charAt(0)}</div>
                <div class="card-info">
                    <h2>${gig.ProjectTitle}</h2>
                    <p class="company">${gig.Client}</p>
                </div>
            </div>
            <div class="card-details">
                <span class="detail-tag">üí∞ ${gig.Budget}</span>
                <span class="detail-tag">‚è≥ ${gig.ProjectLength}</span>
            </div>`;
        return card;
    }

    function renderServiceCard(pro) {
        const card = document.createElement('div');
        card.className = 'job-card';
        card.innerHTML = `
             <div class="card-top">
                <div class="company-logo">${pro.Name.charAt(0)}</div>
                <div class="card-info">
                    <h2>${pro.Name}</h2>
                    <p class="company">${pro.ServiceType}</p>
                </div>
            </div>
            <div class="card-details">
                <span class="detail-tag">üìç ${pro.Location}</span>
                <span class="detail-tag">‚≠ê ${pro.Rating} Stars</span>
            </div>`;
        return card;
    }
    
    // Detail Renderers
    function renderJobDetails(job) {
        return `
            <div class="detail-header"><h2>${job['Job Title']}</h2></div>
            <div class="detail-body"><p>${job.Description.replace(/\n/g, '<br>')}</p></div>`;
    }
     function renderFreelanceDetails(gig) {
        return `
            <div class="detail-header"><h2>${gig.ProjectTitle}</h2></div>
            <div class="detail-body"><p>${gig.Description.replace(/\n/g, '<br>')}</p></div>`;
    }
     function renderServiceDetails(pro) {
        return `
            <div class="detail-header"><h2>${pro.Name}</h2></div>
            <div class="detail-body"><p>${pro.ServicesOffered.replace(/\n/g, '<br>')}</p></div>`;
    }
    
    // --- AUTH UI ---
    function renderAuthUI() {
        const lang = translations[state.currentLang];
        if (state.currentUser) {
            authContainer.innerHTML = `
                <div class="user-info">
                    <span>${state.currentUser.email}</span>
                    <button id="dashboard-btn">${lang.myDashboard}</button>
                    <button id="sign-out-btn">${lang.signOut}</button>
                </div>`;
            document.getElementById('sign-out-btn').addEventListener('click', () => auth.signOut());
            document.getElementById('dashboard-btn').addEventListener('click', () => document.getElementById('dashboard-modal').classList.add('visible'));
        } else {
            authContainer.innerHTML = `
                <button id="signin-btn">${lang.signIn}</button>
                <button id="signup-btn" class="primary">${lang.signUp}</button>`;
            document.getElementById('signin-btn').addEventListener('click', () => openAuthModal(false));
            document.getElementById('signup-btn').addEventListener('click', () => openAuthModal(true));
        }
    }
    
     function openAuthModal(isSignUp = false) {
        const title = isSignUp ? 'Sign Up' : 'Sign In';
        document.getElementById('auth-modal-title').textContent = title;
        document.getElementById('email-form-button').textContent = title;
        document.getElementById('auth-modal').classList.add('visible');
    }

    // --- DATA FETCHING ---
    async function loadAllData() {
        const jobsSnapshot = await db.collection('jobs').get();
        state.allJobs = jobsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

        const freelanceSnapshot = await db.collection('freelance_projects').get();
        state.allFreelance = freelanceSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

        const servicesSnapshot = await db.collection('local_services').get();
        state.allServices = servicesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        
        renderApp();
    }
    
    // --- AI FEATURES ---
    function handleFileSelect(event) {
        const file = event.target.files[0];
        if (file) {
            document.getElementById('file-name').textContent = `Selected: ${file.name}`;
        }
    }

    async function analyzeResume() {
        const fileInput = document.getElementById('resume-file-input');
        const file = fileInput.files[0];
        if (!file) {
            alert('Please upload a resume file.');
            return;
        }

        const resultsContainer = document.getElementById('resume-results');
        resultsContainer.innerHTML = `<p><em>Reading file and analyzing with AI...</em></p>`;
        resultsContainer.classList.remove('hidden');

        let resumeText = '';
        try {
            if (file.type === 'application/pdf') {
                const reader = new FileReader();
                reader.onload = async function() {
                    const typedarray = new Uint8Array(this.result);
                    const pdf = await pdfjsLib.getDocument(typedarray).promise;
                    let text = '';
                    for (let i = 1; i <= pdf.numPages; i++) {
                        const page = await pdf.getPage(i);
                        const content = await page.getTextContent();
                        text += content.items.map(item => item.str).join(' ');
                    }
                    resumeText = text;
                    callResumeAnalysisAPI(resumeText);
                };
                reader.readAsArrayBuffer(file);
            } else {
                resumeText = await file.text();
                callResumeAnalysisAPI(resumeText);
            }
        } catch (error) {
             console.error("File Reading Error:", error);
            resultsContainer.innerHTML = `<p style="color:red;">Could not read the uploaded file.</p>`;
        }
    }

    async function callResumeAnalysisAPI(resumeText) {
        const resultsContainer = document.getElementById('resume-results');
        if (!GEMINI_API_KEY) {
             resultsContainer.innerHTML = `<p style="color:red;">Please configure your Gemini API Key to use this feature.</p>`;
             return;
        }

        const prompt = `Act as an expert career coach. Analyze the following resume text. Provide a rating out of 100. Then, provide a concise summary with three sections: 'Strengths', 'Areas for Improvement', and 'Actionable Tips'. The response must be in a clean JSON format with keys: "score", "strengths", "improvements", "tips". The value for strengths, improvements and tips should be an array of strings.\n\nResume Text: ${resumeText}`;
        
        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${GEMINI_API_KEY}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: { responseMimeType: "application/json" }
                })
            });
            if (!response.ok) throw new Error('AI API request failed');
            
            const data = await response.json();
            const analysis = JSON.parse(data.candidates[0].content.parts[0].text);

            resultsContainer.innerHTML = `
                <h2>Analysis Complete! Score: ${analysis.score}/100</h2>
                <h3>Strengths</h3>
                <ul>${analysis.strengths.map(s => `<li>${s}</li>`).join('')}</ul>
                <h3>Areas for Improvement</h3>
                <ul>${analysis.improvements.map(i => `<li>${i}</li>`).join('')}</ul>
                <h3>Actionable Tips</h3>
                <ul>${analysis.tips.map(t => `<li>${t}</li>`).join('')}</ul>
            `;
            resultsContainer.classList.add('visible');
        } catch (error) {
            console.error("Resume Analysis Error:", error);
            resultsContainer.innerHTML = `<p style="color:red;">Sorry, an error occurred during analysis.</p>`;
             resultsContainer.classList.add('visible');
        }
    }


    // --- EVENT LISTENERS ---
    mainNav.addEventListener('click', (e) => {
        e.preventDefault();
        const view = e.target.dataset.view;
        if (view) {
            navigate(view);
        }
    });
    
    languageSelector.addEventListener('change', (e) => {
        setLanguage(e.target.value);
    });

    auth.onAuthStateChanged(user => {
        state.currentUser = user;
        renderAuthUI();
        if (user) {
            // fetch user-specific data
        }
    });
    
    modalContainer.addEventListener('click', (e) => {
        if (e.target.classList.contains('modal-overlay') || e.target.classList.contains('close-button')) {
            document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('visible'));
        }
    });

    // Initial Load
    document.addEventListener('DOMContentLoaded', () => {
        loadAllData();
        setLanguage('en');
    });

    </script>
</body>
</html>
